<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title><%= reports[0]?.pageTitle || "診断結果｜概要" %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/report.css" />
</head>
<body class="print-a4">
  <% reports.forEach(report => { %>
    <% var pageCounter = 1; %>
    <main class="sheet" id="<%= report.driverId %>-page-<%= pageCounter %>">
      <%- include('../partials/header_gaiyou', { report: report }) %>
      <%- include('../partials/body_gaiyou', { report: report }) %>
    </main>
    <% pageCounter++; %>

    <% const detailSections = report.detailSections || []; %>
    <% detailSections.forEach(function(section) { %>
      <% const pages = section.pages || []; %>
      <% if (pages.length === 0) { %>
        <main class="sheet" id="<%= report.driverId %>-page-<%= pageCounter %>" style="page-break-before: always;">
          <%- include('../partials/header_detail', { report: report, section: section, pageIndex: 0, totalPages: 1 }) %>
          <%- include('../partials/body_detail', { report: report, section: section, page: null, pageIndex: 0, totalPages: 1 }) %>
        </main>
        <% pageCounter++; %>
      <% } else { %>
        <% pages.forEach((page, idx) => { %>
          <main class="sheet" id="<%= report.driverId %>-page-<%= pageCounter %>" style="page-break-before: always;">
            <%- include('../partials/header_detail', { report: report, section: section, pageIndex: idx, totalPages: pages.length }) %>
            <%- include('../partials/body_detail', { report: report, section: section, page: page, pageIndex: idx, totalPages: pages.length }) %>
          </main>
          <% pageCounter++; %>
        <% }) %>
      <% } %>
    <% }) %>

    <main class="sheet" id="<%= report.driverId %>-page-<%= pageCounter %>" style="page-break-before: always;">
      <%- include('../partials/header_sidou', { report: report }) %>
      <%- include('../partials/body_sidou', { report: report }) %>
    </main>

  <% }) %>
</body>
</html>
