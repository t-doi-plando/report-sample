      <!-- ===== KPI（平均と順位） ===== -->
      <section class="headline">
        <div class="headline__label">違反疑い割合平均</div>
        <div class="headline__value"><%= (report.avgViolationRatePct ?? 10.9) %>%</div>
        <div class="headline__rank">(<%= (report.rank?.total ?? 10) %>人中<%= (report.rank?.position ?? 8) %>位)</div>
      </section>

      <!-- ===== ハイライト3カード ===== -->
      <section class="highlights">
        <% const cards = report.highlights_gaiyou || []; %>
        <% cards.forEach(c => { %>
          <article class="hl hl--<%= c.kind %>">
            <div class="hl__band"><%= c.badge %></div>
            <h2 class="hl__title"><%= c.title || '' %></h2>
            <p class="hl__text"><%= (c.text && c.text.trim()) ? c.text : '本文未設定' %></p>
          </article>
        <% }) %>
      </section>

      <% const groups = report.sections || []; %>
      <% groups.forEach(g => { %>
        <table class="group-table">
          <thead>
            <tr>
              <th class="cell--no"><%= g.title %></th>
              <th class="cell--name">項目</th>
              <th class="cell--tag">指導提案</th>
              <th class="cell--rate">違反疑い割合</th>
              <th class="cell--count">危険疑い回数</th>
              <th class="cell--page">詳細</th>
            </tr>
          </thead>
          <tbody>
            <% g.rows.forEach(r => { %>
              <tr class="<%= r.tone ? 'row--' + r.tone : '' %>">
                <td class="cell--no">
                  <% if (r.no !== "") { %>
                    <span class="no"><%= r.no %></span>
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td class="cell--name"><%= r.name %></td>
                <td class="cell--tag">
                  <% if (Array.isArray(r.tags) && r.tags.length > 0) { %>
                    <div class="tags">
                      <% r.tags.forEach(tone => { %>
                        <span class="tag-pill tag-pill--<%= tone %>">
                          <%= (tone === 'good') ? '◎' : '！' %>
                        </span>
                      <% }) %>
                    </div>
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td class="cell--rate">
                  <% if (r.rate !== "" && r.rate !== null && r.rate !== undefined) { %>
                    <strong class="rate"><%= r.rate %>%</strong>
                    <div class="detail"><%= r.detail %></div>
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td class="cell--count">
                  <% if (r.risk !== "" && r.risk !== null && r.risk !== undefined) { %>
                    <strong><%= r.risk %>回</strong>
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td class="cell--page">
                  <% const dynPageNum = (typeof r.pageNumber === 'number') ? r.pageNumber : null; %>
                  <% if (dynPageNum) { %>
                    <a class="btn" href="#<%= report.driverId %>-page-<%= dynPageNum %>"><%= dynPageNum %>ページ ▶</a>
                  <% } else { %>
                    <span class="btn" style="opacity:.7;">ページなし</span>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% }) %>
