      <% const isFirstPage = (typeof pageIndex === 'number' ? pageIndex === 0 : true); %>
      <% if (isFirstPage) { %>
        <!-- ===== „Éè„Ç§„É©„Ç§„Éà3„Ç´„Éº„ÉâÔºà1„Éö„Éº„Ç∏ÁõÆ„ÅÆ„ÅøÔºâ ===== -->
        <section class="highlights highlights--detail">
          <% const cards = section.highlights || []; %>
          <% cards.forEach(c => { %>
            <article class="hl hl--<%= c.kind %>">
              <div class="hl__band hl__band--sasetumae">
                <span class="hl__band-label"><%= c.badge %></span>
                <% const riskValue = (c && typeof c.risk === 'number' && Number.isFinite(c.risk)) ? c.risk : null; %>
                <% if (c.kind === 'danger' && riskValue !== null) { %>
                  <span class="hl__band-meta">
                    <span class="hl__band-metaRiskNumber"><%= riskValue %></span>
                    <span class="hl__band-metaRiskUnit">Âõû</span>
                  </span>
                <% } else if (c.kind === 'warn') { %>
                  <% const rateValue = (c && typeof c.rate === 'number' && Number.isFinite(c.rate)) ? c.rate : null; %>
                  <% const rateDetail = (typeof c.rateDetail === 'string' && c.rateDetail.trim().length > 0) ? c.rateDetail : null; %>
                  <% if (rateValue !== null) { %>
                    <span class="hl__band-meta hl__band-meta--warn">
                      <span class="hl__band-metaWarnTop">
                        <span class="hl__band-metaWarnNumber"><%= rateValue %></span>
                        <span class="hl__band-metaWarnUnit">ÔºÖ</span>
                      </span>
                      <% if (rateDetail) { %>
                        <span class="hl__band-metaWarnCaption"><%= rateDetail %></span>
                      <% } %>
                    </span>
                  <% } %>
                <% } %>
              </div>
              <div class="hl__divider"></div>
              <p class="hl__text"><%= (c.text && c.text.trim()) ? c.text : 'Êú¨ÊñáÊú™Ë®≠ÂÆö' %></p>
            </article>
          <% }) %>
        </section>
      <% } %>

      <div class="violations-scene-title">ÈÅïÂèçÁñë„ÅÑ„Ç∑„Éº„É≥‰∏ÄË¶ß</div>
      <table class="scenes-table">
        <thead>
          <tr>
            <th colspan="3">Áô∫ÁîüÊó•ÊôÇ</th>
            <th>Âç±Èô∫Áñë„ÅÑÈ†ÖÁõÆ</th>
            <th>ÂãïÁîª</th>
            <th>Âú∞Âõ≥</th>
          </tr>
        </thead>
        <tbody>
          <% if (!page || !page.groups || page.groups.length === 0) { %>
            <tr>
              <td colspan="6" style="text-align:center; color: var(--ink-600);">Ë°®Á§∫„Åß„Åç„Çã„Ç∑„Éº„É≥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td>
            </tr>
          <% } else { %>
            <% page.groups.forEach((yg, yi) => { %>
              <% const yearRowCount = yg.dates.reduce((acc, d) => acc + d.scenes.length, 0); %>
              <% yg.dates.forEach((dg, di) => { %>
                <% dg.scenes.forEach((s, si) => { %>
                  <% const timeStr = new Intl.DateTimeFormat('ja-JP', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Asia/Tokyo' }).format(new Date(s.capturedAt)); %>
                  <tr>
                    <% if (di === 0 && si === 0) { %>
                      <td class="scenes-year" rowspan="<%= yearRowCount %>"><%= yg.year %></td>
                    <% } %>
                    <% if (si === 0) { %>
                      <td class="scenes-date" rowspan="<%= dg.scenes.length %>"><%= dg.dateLabel %></td>
                    <% } %>
                    <td class="scenes-time"><%= timeStr %></td>
                    <td class="scenes-item">
                      <% const sceneType = (typeof s.type === 'string') ? s.type.trim() : ''; %>
                      <span class="scenes-item-icon">
                        <% if (sceneType === 'hard_brake') { %>
                          <img src="/img/hard_brake.svg" alt="ÊÄ•„Éñ„É¨„Éº„Ç≠" class="scenes-item-icon__img">
                        <% } else if (sceneType === 'near_miss_contact') { %>
                          <img src="/img/near_miss_contact.svg" alt="Êé•Ëß¶Êú™ÈÅÇ" class="scenes-item-icon__img">
                        <% } %>
                      </span>
                    </td>
                    <td class="scenes-actions">
                      <% if (s.videoUrl) { %>
                        <a href="<%= s.videoUrl %>" class="scenes-btn" target="_blank"><span class="icon">‚ñ∂</span>ÂãïÁîª„ÇíÁ¢∫Ë™ç„Åô„Çã</a>
                      <% } else { %>
                        -
                      <% } %>
                    </td>
                    <td class="scenes-actions">
                      <% 
                        let mapUrl = s.MapViewUrl || s.streetViewUrl;
                        if (!s.MapViewUrl && s.streetViewUrl && s.streetViewUrl.includes('map_action=pano') && s.streetViewUrl.includes('viewpoint=')) {
                          try {
                            const qp = s.streetViewUrl.split('viewpoint=')[1];
                            if (qp) { mapUrl = 'https://www.google.com/maps/search/?api=1&query=' + qp; }
                          } catch (e) {}
                        }
                      %>
                      <% if (mapUrl) { %>
                        <a href="<%= mapUrl %>" class="scenes-btn" target="_blank"><span class="icon">üìç</span>Âú∞Âõ≥„ÇíÁ¢∫Ë™ç„Åô„Çã</a>
                      <% } else { %>
                        -
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              <% }) %>
            <% }) %>
          <% } %>
        </tbody>
      </table>
