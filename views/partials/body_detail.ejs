      <% const isFirstPage = (typeof pageIndex === 'number' ? pageIndex === 0 : true); %>
      <% if (isFirstPage) { %>
        <!-- ===== „Éè„Ç§„É©„Ç§„Éà3„Ç´„Éº„ÉâÔºà1„Éö„Éº„Ç∏ÁõÆ„ÅÆ„ÅøÔºâ ===== -->
        <section class="highlights highlights--detail">
          <% const cards = section.highlights || []; %>
          <% cards.forEach(c => { %>
            <% const kind = c.kind; %>
            <% const metric = c.metric || {}; %>
            <% const riskValue = (kind === 'danger' && typeof metric.risk === 'number' && Number.isFinite(metric.risk)) ? metric.risk : null; %>
            <% const rateValue = (kind === 'warn' && typeof metric.rate === 'number' && Number.isFinite(metric.rate)) ? metric.rate : null; %>
            <% const rateDetail = (kind === 'warn' && typeof metric.detail === 'string' && metric.detail.trim().length > 0) ? metric.detail : null; %>
            <article class="hl hl--<%= kind %> hl--detail-card">
              <div class="hl-cardHeader">
                <span class="hl-cardTitleText"><%= c.badge %></span>
                <div class="hl-cardMetricWrapper">
                  <div class="hl-cardMetricGroup">
                    <% if (kind === 'danger' && riskValue !== null) { %>
                      <span class="hl-cardMetricRow">
                        <span class="hl-cardMetricNumber"><%= riskValue %></span>
                        <span class="hl-cardMetricUnit">Âõû</span>
                      </span>
                    <% } else if (kind === 'warn' && rateValue !== null) { %>
                      <span class="hl-cardMetricRow">
                        <span class="hl-cardMetricNumber"><%= rateValue %></span>
                        <span class="hl-cardMetricUnit">ÔºÖ</span>
                      </span>
                      <% if (rateDetail) { %>
                        <span class="hl-cardMetricDetail"><%= rateDetail %></span>
                      <% } %>
                    <% } %>
                  </div>
                  <% if (kind === 'danger' || kind === 'warn') { %>
                    <span class="hl-cardIcon hl-cardIcon--<%= kind %>">ÔºÅ</span>
                  <% } %>
                </div>
              </div>
              <div class="hl__divider"></div>
              <p class="hl__text hl__text-detail"><%= (c.text && c.text.trim()) ? c.text : 'Êú¨ÊñáÊú™Ë®≠ÂÆö' %></p>
            </article>
          <% }) %>
        </section>
      <% } %>

      <div class="violations-scene-title">ÈÅïÂèçÁñë„ÅÑ„Ç∑„Éº„É≥‰∏ÄË¶ß</div>
      <table class="scenes-table">
        <thead>
          <tr>
            <th colspan="3">Áô∫ÁîüÊó•ÊôÇ</th>
            <th>Âç±Èô∫Áñë„ÅÑÈ†ÖÁõÆ</th>
            <th>ÂãïÁîª</th>
            <th>Âú∞Âõ≥</th>
          </tr>
        </thead>
        <tbody>
          <% if (!page || !page.groups || page.groups.length === 0) { %>
            <tr>
              <td colspan="6" style="text-align:center; color: var(--ink-600);">Ë°®Á§∫„Åß„Åç„Çã„Ç∑„Éº„É≥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td>
            </tr>
          <% } else { %>
            <% page.groups.forEach((yg, yi) => { %>
              <% const yearRowCount = yg.dates.reduce((acc, d) => acc + d.scenes.length, 0); %>
              <% yg.dates.forEach((dg, di) => { %>
                <% dg.scenes.forEach((s, si) => { %>
                  <% const timeStr = new Intl.DateTimeFormat('ja-JP', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Asia/Tokyo' }).format(new Date(s.capturedAt)); %>
                  <tr>
                    <% if (di === 0 && si === 0) { %>
                      <td class="scenes-year" rowspan="<%= yearRowCount %>"><%= yg.year %></td>
                    <% } %>
                    <% if (si === 0) { %>
                      <td class="scenes-date" rowspan="<%= dg.scenes.length %>"><%= dg.dateLabel %></td>
                    <% } %>
                    <td class="scenes-time"><%= timeStr %></td>
                    <td class="scenes-item">
                      <% const sceneType = (typeof s.type === 'string') ? s.type.trim() : ''; %>
                      <span class="scenes-item-icon">
                        <% if (sceneType === 'hard_brake') { %>
                          <img src="/img/hard_brake.svg" alt="ÊÄ•„Éñ„É¨„Éº„Ç≠" class="scenes-item-icon__img">
                        <% } else if (sceneType === 'near_miss_contact') { %>
                          <img src="/img/near_miss_contact.svg" alt="Êé•Ëß¶Êú™ÈÅÇ" class="scenes-item-icon__img">
                        <% } %>
                      </span>
                    </td>
                    <td class="scenes-actions">
                      <% if (s.videoUrl) { %>
                        <a href="<%= s.videoUrl %>" class="scenes-btn" target="_blank"><span class="icon">‚ñ∂</span>ÂãïÁîª„ÇíÁ¢∫Ë™ç„Åô„Çã</a>
                      <% } else { %>
                        -
                      <% } %>
                    </td>
                    <td class="scenes-actions">
                      <% 
                        let mapUrl = s.MapViewUrl || s.streetViewUrl;
                        if (!s.MapViewUrl && s.streetViewUrl && s.streetViewUrl.includes('map_action=pano') && s.streetViewUrl.includes('viewpoint=')) {
                          try {
                            const qp = s.streetViewUrl.split('viewpoint=')[1];
                            if (qp) { mapUrl = 'https://www.google.com/maps/search/?api=1&query=' + qp; }
                          } catch (e) {}
                        }
                      %>
                      <% if (mapUrl) { %>
                        <a href="<%= mapUrl %>" class="scenes-btn" target="_blank"><span class="icon">üìç</span>Âú∞Âõ≥„ÇíÁ¢∫Ë™ç„Åô„Çã</a>
                      <% } else { %>
                        -
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              <% }) %>
            <% }) %>
          <% } %>
        </tbody>
      </table>
