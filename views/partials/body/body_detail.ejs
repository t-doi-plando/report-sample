      <section class="detail-risk">
        <div class="detail-risk__row">
          <span class="detail-risk__lead">事故リスクが高いと判定された指導項目</span>
          <span class="detail-risk__title"><%= report.highRiskGuidanceLabel || '項目未設定' %></span>
        </div>
      </section>

      <% const scenes = (page && page.scenes) || []; let prevYear = null; const hasLatest = scenes.some(s => s.isLatest); const hasScenes = scenes.length > 0; %>
      <% if (hasScenes) { %>
      <section class="detail-list">
        <div class="detail-table">
          <div class="detail-table__caption">違反疑い動画一覧</div>
          <div class="detail-table__row detail-table__row--header">
            <div class="detail-table__cell detail-table__icon"></div>
            <div class="detail-table__cell detail-table__date">発生日時</div>
            <div class="detail-table__cell detail-table__violation">違反疑い</div>
            <div class="detail-table__cell detail-table__danger">危険疑い</div>
            <div class="detail-table__cell detail-table__links">リンク</div>
          </div>
          <% scenes.forEach(function(scene){ %>
            <% if (scene.year !== prevYear) { %>
              <div class="detail-table__row detail-table__row--year">
                <span class="detail-table__yearNumber"><%= scene.year %></span><span class="detail-table__yearUnit">年</span>
              </div>
              <% prevYear = scene.year; %>
            <% } %>
            <div class="detail-table__row detail-table__row--tone <%= scene.riskLabel ? 'detail-table__row--alert' : '' %>">
              <div class="detail-table__cell detail-table__icon">
                <% if (scene.isLatest) { %>
                  <img src="/img/icon/recent_red.svg" alt="最新" class="detail-table__recentIcon" />
                <% } %>
              </div>
              <div class="detail-table__cell detail-table__date detail-table__date--day">
                <% const dateFull = scene.dateLabel || ''; 
                   const dateParts = dateFull.split('/');
                   const mdLabel = (dateParts.length >= 3) ? `${dateParts[1]}/${dateParts[2]}` : dateFull; 
                   const weekdayRaw = scene.weekdayLabel || scene.dowLabel || '';
                   let weekdayResolved = weekdayRaw;
                   if (!weekdayResolved && dateParts.length >= 3) {
                     const y = Number(dateParts[0]); const m = Number(dateParts[1]); const d = Number(dateParts[2]);
                     if (Number.isFinite(y) && Number.isFinite(m) && Number.isFinite(d)) {
                       const w = new Date(Date.UTC(y, m - 1, d)).getUTCDay();
                       const WN = ['日','月','火','水','木','金','土'];
                       weekdayResolved = WN[w] || '';
                     }
                   }
                   const vSummaryRaw = scene.violationSummary || '詳細文言が未設定です';
                   const vSummaryParts = vSummaryRaw.split('\n');
                %>
                <div class="detail-table__dayMd"><%= mdLabel %></div>
                <% if (weekdayResolved) { 
                     const dowClass = weekdayResolved === '土' ? 'detail-table__dow--sat'
                                   : weekdayResolved === '日' ? 'detail-table__dow--sun'
                                   : '';
                %>
                  <div class="detail-table__dow <%= dowClass %>">(<%= weekdayResolved %>)</div>
                <% } %>
                <div class="detail-table__time"><%= scene.timeLabel || '' %></div>
              </div>
                <div class="detail-table__cell detail-table__violation">
                  <div class="detail-table__label">
                    <span class="detail-table__labelLine detail-table__labelLine--primary"><%= vSummaryParts[0] %></span>
                    <% if (vSummaryParts.length > 1) { %>
                      <span class="detail-table__labelLine detail-table__labelLine--sub"><%= vSummaryParts.slice(1).join(' ') %></span>
                    <% } %>
                  </div>
                </div>
              <div class="detail-table__cell detail-table__danger">
                <% if (scene.riskLabel) { %>
                  <% const riskLabel = scene.riskLabel || ''; 
                     const riskIcon = riskLabel.includes('急ブレーキ') ? '/img/icon/hard_brake.svg'
                                   : (riskLabel.includes('接触未遂') ? '/img/icon/near_miss_contact.svg' : null);
                  %>
                  <% if (riskIcon) { %>
                    <span class="detail-tag detail-tag--danger detail-tag--icon detail-tag--iconOnly">
                      <img src="<%= riskIcon %>" alt="<%= riskLabel %>" class="detail-tag__iconImg" />
                    </span>
                  <% } else { %>
                    <span class="detail-tag detail-tag--danger detail-tag--icon"><%= riskLabel %></span>
                  <% } %>
                <% } %>
              </div>
              <div class="detail-table__cell detail-table__links">
                <div class="detail-links">
                  <% if (scene.movieUrl) { %>
                    <a class="detail-linkBtn detail-linkBtn--primary detail-linkBtn--icon" href="<%= scene.movieUrl %>" target="_blank" rel="noopener noreferrer">
                      <img src="/img/icon/movie.svg" alt="動画" class="detail-linkBtn__icon" />
                    </a>
                  <% } else { %>
                    <span class="detail-linkBtn detail-linkBtn--ghost">動画なし</span>
                  <% } %>
                  <% if (scene.mapUrl) { %>
                    <a class="detail-linkBtn detail-linkBtn--ghost detail-linkBtn--icon" href="<%= scene.mapUrl %>" target="_blank" rel="noopener noreferrer">
                      <img src="/img/icon/map.svg" alt="地図" class="detail-linkBtn__icon" />
                    </a>
                  <% } else { %>
                    <span class="detail-linkBtn detail-linkBtn--ghost">地図なし</span>
                  <% } %>
                </div>
              </div>
            </div>
          <% }); %>
        </div>
        <% if (hasLatest) { %>
        <div class="detail-note">
          <img src="/img/icon/recent_gray.svg" alt="最新" class="detail-note__icon" />
          ：直近の違反疑いシーン（1ページ目）に表示されている動画になります。
        </div>
        <% } %>
      </section>
      <% } %>
      <% if (page && page.includeMemo && report.showMemo) { %>
      <section class="detail-memo">
        <div class="detail-memo__title">ドライバーメモ</div>
        <p class="detail-memo__desc">次回からの運転で気を付けようと思ったことや、今回のアドバイスを受けての感想などを記載してください。</p>
        <div class="detail-memo__box"></div>
        <div class="detail-memo__advisor">アドバイザー署名<span class="detail-memo__line"></span></div>
      </section>
      <% } %>
