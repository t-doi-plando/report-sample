/* ===== A4・印刷設定 ===== */
@page {
  size: A4;
  margin: 15mm 12mm; /* Set page margins */

  @bottom-right {
    content: counter(page) " / " counter(pages);
    font-family: "Noto Sans JP","Yu Gothic","Meiryo",system-ui,sans-serif;
    font-size: 9pt;
    color: var(--ink-400);
  }
}
* { box-sizing: border-box; }
html, body { height: 100%; }
body.print-a4 {
  margin: 0;
  -webkit-print-color-adjust: exact;
  print-color-adjust: exact;
  font-family: "Noto Sans JP","Yu Gothic","Meiryo",system-ui,sans-serif;
  color: #0b1420;
}

/* カラートークン（近似） */
:root{
  --blue-700:#0D47A0; --blue-600:#082B60; --blue-100:#eaf2ff;
  --ink-900:#0b1420;  --ink-600:#5a6b84;  --ink-400:#7f8ea4;
  --line:#e7edf5;     --panel:#ffffff;    --bg:#f3f6fb;

  --red-600:#A0140A;  --red-050:#fdeeee;
  --amber-600:#E6AA19;--amber-050:#fff3de;
  --green-600:#3CBE2D;--green-050:#eaf7ea;
  /* 固定メタ幅（右側の事業所/氏名エリア） */
  --meta-width: 32ch;
}

/* A4 1枚のシート */
.sheet{
  display:grid; gap:4mm;
  align-content: start;
  page-break-after: always;
}

/* ===== ヘッダー（青帯） ===== */
.topbar{
  background: linear-gradient(90deg, var(--blue-700), var(--blue-600));
  color:#fff; border-radius:6px; padding:6mm 8mm;
  /* タイトル（左）とメタ（右）を固定2カラムで配置 */
  display:grid; grid-template-columns: 1fr var(--meta-width); align-items:center;
}
.topbar__title{ margin:0; font-size:16pt; font-weight:800; letter-spacing:.02em; white-space: nowrap; }
.topbar__title .page-of{ margin-left:0; font-size:.8em; opacity:.85; }
.topbar__title .sep{ opacity:.6; margin:0 .5em; }
.meta{ display:flex; gap:1ch; margin:0; justify-content: flex-end; align-items:flex-start; flex-wrap: nowrap; }
.meta__item{ min-width:0; flex: 0 1 auto; }
.meta__item dt{ opacity:.85; font-size:9.5pt; }
/* メタテキストは2行クランプ（高さ固定）、右寄せ・折返し */
.meta__item dd{
  margin:0; font-size:10.5pt; font-weight:700;
  max-width:100%; white-space: normal; text-align: left;
  overflow-wrap:anywhere; word-break:break-word;
  display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2; overflow:hidden; text-overflow:ellipsis;
}
/* Office name small when too long */
.meta__office--small{ line-height: 1.2; }
.meta__item dd.meta__office--small{ font-size: 50%; -webkit-line-clamp:2; }
/* Driver name small when too long */
.meta__name--small{ line-height: 1.2; }
.meta__item dd.meta__name--small{ font-size: 50%; -webkit-line-clamp:2; }
/* Office name: force earlier breaks to avoid layout push */
.meta__office{ overflow-wrap:anywhere; word-break: break-all; }

/* ===== KPI 行 ===== */
.headline{
  display:flex; align-items:flex-end; justify-content:flex-end; gap:6mm; padding:0 2mm;
}
.headline__label{ color:var(--blue-700); font-size:10pt; }
.headline__value{ font-size:22pt; font-weight:800; line-height:1; }
.headline__value-percent{
  font-size:0.75em;
  margin-left:0.1em;
  vertical-align:baseline;
}
.headline__rank{ color:var(--ink-400); font-size:10pt; }

.sidou-headline{
  display:flex; flex-direction: column; align-items:flex-start; justify-content:flex-start;   gap:1mm; padding:0 2mm;
}
.sidou-item-number-label{ color:var(--blue-700); font-size:10pt; text-align: left; font-weight: bold; }

.sidou-border-box{
  border: 1px solid var(--blue-700);
  border-radius: 4px;
  min-height: 16mm;
  width: 100%;
  padding: 2mm;
}

.sidou-example-text{
  color: var(--ink-600);
  font-size: 9pt;
  margin-top: 1mm;
}

.sidou-checkbox-text{
  color: var(--ink-600);
  font-size: 9pt;
  margin-top: auto;
  vertical-align: text-top; /* 調整 */
}

.checkbox-square{
  font-size: 2em;
  margin-right: 0.2em;
  vertical-align: -0.20em; /* 文言と縦位置があうように調整 */
  line-height: 1;
}

.sidou-content-headline{
  margin-top: 2.0mm;
}

.sidou-driver-response-headline{
  margin-top: 2.0mm;
}

.sidou-content-border-box{
  border: 1px solid var(--blue-700);
  border-radius: 4px;
  min-height: 90mm;
  width: 100%;
  padding: 2mm;
  margin-top: 1mm;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

/* ===== ハイライト3カード ===== */
.highlights{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:4.8mm;
  padding:0 1mm;
}

/* 違反疑いシーン一覧 見出し */
.violations-scene-title{
  color: var(--blue-700);
  text-align: left;
  font-weight: 700;
  font-size: 10.5pt; 
  margin-bottom: 0.0mm;
}
/* ページ内ページ数 (X / N) の控えめな表示 */
.violations-scene-title .page-of{
  margin-left: 4mm;
  font-size: 9.5pt;
  color: var(--ink-600);
}

/* ===== 違反疑いシーン一覧（モック） ===== */
.scenes-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border-style: solid;
  border-color: var(--line);
  border-width: 0 0 1px 0; /* 下線のみ */
  background: var(--panel);
  margin-top: 0.0mm;
}
.scenes-table thead th {
  background: transparent;
  padding: 2.5mm 4mm;
  font-size: 9pt;
  font-weight: 700;
  color: var(--ink-600);
  text-align: center; /* ヘッダ中央寄せ */
  border-bottom: 1px solid var(--line);
  border-top: none; /* 上線削除 */
}
.scenes-table th, .scenes-table td {
  padding: 2.5mm 4mm;
  text-align: left;
  vertical-align: top;
  border: none;
  border-top: 1px solid var(--line);
  font-size: 10pt;
}
.scenes-table td.scenes-year {
  font-size: 16pt;
  font-weight: 800;
  color: var(--ink-900);
  width: 20mm;
}
.scenes-table td.scenes-date { width: 16mm; font-weight: 700; }
.scenes-table td.scenes-time { width: 16mm; }
.scenes-table td.scenes-item { color: var(--ink-900); }
.scenes-table td.scenes-actions { width: 36mm; }

.scenes-item-icon { margin-right: 3mm; opacity: .9; }
.scenes-item-icon__img {
  display: inline-block;
  width: auto;
  height: 7mm;
  object-fit: contain;
}

.scenes-btn {
  display: inline-flex;
  align-items: center;
  gap: 3mm;
  padding: 1.5mm 4mm;
  border: 1px solid var(--blue-700);
  color: var(--blue-700);
  background: #fff;
  border-radius: 1mm;
  font-size: 9pt;
  font-weight: 700;
  text-decoration: none;
  white-space: nowrap;
}
.scenes-btn:hover { filter: brightness(0.95); }
.scenes-btn__icon {
  width: 4mm;
  height: 4mm;
  object-fit: contain;
}
.hl{
  background: var(--panel);
  border:1px solid var(--line);
  border-radius:8px;
  padding:6mm 5mm;
  display:flex;
  flex-direction:column;
  gap:3.5mm;
  min-height:56mm;
  max-height:56mm;
  overflow:hidden;
  position:relative;
}
.highlights--summary .hl{
  padding-top:16mm;
}
.highlights--detail .hl{
  min-height:48mm;
  max-height:48mm;
  padding:5mm 4mm 4mm;
  gap:1mm;
  position:relative;
}
.hl__divider{
  position:absolute;
  left:5mm;
  right:5mm;
  top:20.5mm;
  border-top:1px solid var(--line);
}
.highlights--detail .hl__divider{
  top:15.5mm;
}
.highlights--summary .hl__divider{
  position:absolute;
  left:5mm;
  right:5mm;
  top:23mm;
  border-top:1px solid var(--line);
  margin:0;
}
.hl__text{
  margin:0;
  color:var(--ink-600);
  font-size:9.5pt;
  line-height:1.35;
  display:-webkit-box;
  -webkit-line-clamp:6;
  -webkit-box-orient:vertical;
  overflow:hidden;
}
.highlights--summary .hl__text{
  margin-top:3mm;
}
.hl__text-detail{
  position:absolute;
  left:5mm;
  right:5mm;
  top:18.5mm;
  bottom:6.5mm;
  margin:0;
  color:var(--ink-600);
  font-size:9.5pt;
  line-height:1.35;
  display:-webkit-box;
  -webkit-line-clamp:6;
  -webkit-box-orient:vertical;
  overflow:hidden;
}
.hl__band{
  font-weight:800; font-size:10pt; color:#fff;
  padding:2mm 3mm;
  border-radius:6px;
  text-align:center;
  min-height:12mm;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:2mm;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.highlights--summary .hl__band{
  position:absolute;
  top:-1mm;
  left:0;
  right:0;
  height:12mm;
  padding:0 5mm;
  border-radius:8px 8px 0 0;
}
.hl__band-icon{
  width:4.6mm;
  height:4.6mm;
  object-fit:contain;
}

/* body_sasetumae.ejs 用のハイライトバンドスタイル */
.hl__band--sasetumae {
  background:none;
  color: var(--blue-700);
  text-align:left;
  display:flex;
  align-items:flex-start;
  justify-content:flex-start;
  gap:2mm;
  min-height:8mm;
  width:100%;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.highlights--detail .hl__band--sasetumae {
  min-height:8mm;
  padding:1mm 0 0;
  margin-bottom:1.2mm;
  gap:1.5mm;
  transform: translateX(-3mm);
}
.hl__band-label{ font-weight:inherit; }
.hl__band-meta{
  margin-left:auto;
  display:flex;
  align-items:flex-end;
  gap:1mm;
}
.hl__band-metaRiskNumber{
  font-size:18pt;
  font-weight:800;
  color:var(--ink-900);
  line-height:0.9;
  transform: translateY(-0.6mm);
}
.hl__band-metaRiskUnit{
  font-size:9.5pt;
  font-weight:700;
  color:var(--ink-900);
  line-height:0.9;
  margin-bottom:1mm;
}
.hl__band-meta--warn{
  margin-left:auto;
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:0.4mm;
}
.hl__band-metaWarnTop{
  display:flex;
  align-items:flex-end;
  gap:1mm;
}
.hl__band-metaWarnNumber{
  font-size:16pt;
  font-weight:800;
  color:var(--ink-900);
  line-height:0.9;
  transform: translateY(-0.4mm);
}
.hl__band-metaWarnUnit{
  font-size:9.5pt;
  font-weight:700;
  color:var(--ink-900);
  line-height:0.9;
  margin-bottom:1mm;
}
.hl__band-metaWarnCaption{
  font-size:6pt;
  font-weight:600;
  color:var(--ink-600);
  text-align:right;
}

/* .hl__band--sasetumae が適用されている場合は、以下の背景色を無効化 */
.hl--danger .hl__band.hl__band--sasetumae,
.hl--warn .hl__band.hl__band--sasetumae,
.hl--good .hl__band.hl__band--sasetumae {
  background: none;
  color: var(--blue-700); /* 色も確実に適用されるように再指定 */
  text-align: left; /* 配置も確実に適用されるように再指定 */
}

.hl--danger .hl__band{ background:var(--red-600); }
.hl--warn   .hl__band{ background:var(--amber-600); }
.hl--good   .hl__band{ background:var(--green-600); }
.hl__title{
  margin:0;
  font-size:12pt;
  font-weight:800;
  text-align:center;
  line-height:1.3;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.highlights--summary .hl__title{
  margin-top:-2mm;
}
/* ===== セクション（テーブル） ===== */
.group-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border: 1px solid var(--line);
}
.group-table + .group-table {
  margin-top: 3mm;
}

.summary-frame {
  border: 1px solid var(--line);
  padding: 3mm 10mm;
  margin-top: 10mm;
  border-radius: 8px;
  min-height: 10mm;
  background-color: var(--panel);
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.summary-column {
  flex: 1;
  padding: 0 5mm;
}

.left-column {
  text-align: left;
  font-weight: 600;
  color: var(--ink-900);
  font-size: 10.5pt;
}

.right-column {
  text-align: right;
}

.play-button-mock {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 12mm;
  height: 8mm;
  background-color: var(--red-600);
  color: #fff;
  padding: 0;
  border-radius: 3mm;
  font-size: 10pt;
  font-weight: 600;
  cursor: pointer;
  box-shadow: none;
  transition: all 0.2s ease-in-out;
  text-decoration: none;
  overflow: hidden;
}

.play-button-mock:hover {
  transform: scale(1.05);
  box-shadow: none;
}

.play-icon {
  font-size: 10pt;
  line-height: 1;
  transform: translateX(0.5mm);
}
.group-table thead th {
  background: #fff; /* Reverted color */
  padding: 2.5mm 4mm;
  font-size: 9pt;
  font-weight: 700;
  color: var(--ink-600);
  text-align: center;
  border-bottom: 1px solid var(--line);
  height: 6.5mm; /* Keep height here */
  line-height: 6.5mm; /* ADDED */
}
.group-table thead .cell--no { text-align: left; }
.group-table thead tr:first-child th:first-child {
  border-top-left-radius: 8px;
}
.group-table thead tr:first-child th:last-child {
  border-top-right-radius: 8px;
}


.group-table th, .group-table td {
  padding: 2.5mm 4mm;
  text-align: left;
  vertical-align: top;
  border: none;
  border-top: 1px solid var(--line);
  font-size: 10pt;
}
.group-table tbody tr:first-child td {
  border-top: none; /* No top border for the first row */
}
.group-table .row--danger{ background: var(--red-050); }
.group-table .row--warn  { background: var(--amber-050); }
.group-table .row--good  { background: var(--green-050); }

/* Column widths and alignments */
.group-table .cell--no    { width: 20mm; } /* Removed text-align */
.group-table .cell--name  { width: 42mm; }
.group-table .cell--tag   { width: 26mm; }
.group-table .cell--rate  { width: 38mm; } /* Adjusted */
.group-table .cell--count { width: 32mm; } /* Adjusted */
.group-table .cell--page  { width: 28mm; }
.group-table tbody .cell--page { text-align: left; }

/* Cell content styles (reusing old classes) */
.no{
  display:inline-grid; place-items:center;
  min-width:7mm; height:7mm; padding:0 1.2mm;
  background: #fff;
  border:1px solid #2a5db6; border-radius:1mm; /* Changed */
  font-weight:900; color:#2a5db6;
}
.cell--name{ font-weight:700; }
.cell--tag .tags{
  display:flex;
  flex-direction:row;
  flex-wrap:wrap;
  gap:1mm;
  align-items:center;
  justify-content:center;
}
.tag-pill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:5mm;
  min-height:6mm;
  padding:0.8mm 1.7mm;
  border-radius:2px;
  font-weight:800;
  font-size:9pt;
  line-height:1;
  color:#fff;
  background: var(--ink-600);
  letter-spacing:.05em;
  box-shadow:0 0 0 0.2mm rgba(0,0,0,0.05);
}
.tag-pill__icon{
  width:3.6mm;
  height:3.6mm;
  object-fit:contain;
}
.tag-pill--danger{ background: var(--red-600); }
.tag-pill--warn  { background: var(--amber-600); }
.tag-pill--good  { background: var(--green-600); }
.cell--tag{
  font-weight:800;
  border-radius:2px; /* Changed */
  color:#9b1b1b;
}
.row--warn .cell--tag{ color:inherit; }
.row--good .cell--tag{ color:inherit; }
.rate{
  display:inline-flex;
  align-items:baseline;
  gap:0.8mm;
  font-size:15pt;
  font-weight:800;
  line-height:1;
}
.rate__number{ font-weight:inherit; }
.rate__unit{
  font-size:0.66em;
  font-weight:700;
}
.risk-count{
  display:inline-flex;
  align-items:baseline;
  gap:0.8mm;
  font-size:15pt;
  font-weight:800;
  line-height:1;
}
.risk-count__number{ font-weight:inherit; }
.risk-count__unit{
  font-size:0.66em;
  font-weight:700;
}
.detail{ font-size:8.5pt; color:var(--ink-600); }
.cell--count{ font-weight:800; }
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6.0mm;
  min-height:7mm;
  padding:0 3mm;
  width:24mm;
  border:1px solid #2a5db6; border-radius:1mm; /* Changed */
  font-size:8pt; color:#2a5db6; background:#fff;
  white-space:nowrap; /* Prevent wrapping */
}
.btn__label{
  display:inline-flex;
  align-items:baseline;
  gap:1.0mm;
}
.btn__number{
  font-size:10pt;
  font-weight:800;
  line-height:1;
}
.btn__arrow{ font-weight:800; }
.btn__text{
  font-size:4.5pt;
  font-weight:700;
}
/* Anchor-style buttons should not show underline */
.btn, .btn:visited, .btn:hover, .btn:active{ text-decoration: none; }

.group-table tbody .cell--rate {
  display: flex;
  align-items: baseline;
  gap: 2mm;
}

/* ===== フッター ===== */
.footer{
  text-align:right; color:var(--ink-400); font-size:9pt;
}

/* ===== ハイライトカード（詳細）再調整 ===== */
.hl--detail-card{
  display:flex;
  flex-direction:column;
  gap:2mm;
}
.hl__band--sasetumae{
  display:flex;
  align-items:flex-start;
  justify-content:flex-start;
  gap:2mm;
}
.hl__band--sasetumae .hl__band-left{
  display:flex;
  align-items:center;
  gap:1.6mm;
}
.hl__band-iconBadge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:4mm;
  height:4mm;
  box-shadow:0 1px 2px rgba(0,0,0,0.12);
  transform: translateY(-0.2mm);
  border-radius:0;
}
.hl__band-iconBadge--danger{ background:var(--red-600); }
.hl__band-iconBadge--warn{ background:var(--amber-600); }
.hl__band-iconBadgeImg{
  width:2.6mm;
  height:2.6mm;
  object-fit:contain;
}

/* 画面表示の見栄え */
@media screen{
  body.print-a4{ background:var(--bg); }
  .sheet{
    width: 210mm;
    min-height: 297mm;
    margin: 10px auto;
    padding: 15mm 12mm;
    background: #fff;
    box-shadow: 0 2px 30px rgba(0,0,0,.06);
  }
}
